<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pic">

	<sql id="imgColumns">
		user_id,cont_id,content_title,content_content,pic,view_count,
		TO_CHAR(content_date, 'YY.MM.DD HH24:MI') AS content_date
	</sql>
	
	<select id="getList" resultType="picDto" parameterType="picDto">
	SELECT *	
		FROM (SELECT result1.*,ROWNUM rnum 
		  FROM (SELECT <include refid="imgColumns"/>,name
				FROM tp_picboard
				JOIN tp_account USING(user_id)
				WHERE user_id=#{user_id}
			    ORDER BY cont_id DESC
			    ) result1
	     )
	WHERE rnum BETWEEN #{startRowNum} AND #{endRowNum}
	</select>
	
	<insert id="insert" parameterType="picDto">
		INSERT INTO tp_picboard
		VALUES(#{user_id},tp_picboard_seq.NEXTVAL,#{content_title},#{content_content},
				#{pic},#{view_count},SYSDATE)
	</insert>
	
	<select id="getPicDetail" parameterType="picDto" resultType="picDto">
		SELECT result1.*
		FROM
			(SELECT <include refid="imgColumns"/>,name,
			LAG(cont_id,1,0) OVER(ORDER BY cont_id DESC) prevNum,
			LEAD(cont_id,1,0) OVER(ORDER BY cont_id DESC) nextNum
			FROM tp_picboard
			JOIN tp_account USING(user_id)
			ORDER BY cont_id DESC) result1
		WHERE cont_id=#{cont_id} AND user_id=#{user_id}
	</select>
	
	<update id="update" parameterType="picDto">
		UPDATE tp_picboard
		SET content_title=#{content_title}, content_content=#{content_content}
		WHERE cont_id=#{cont_id}
	</update>
	
	<delete id="delete" parameterType="int">
		DELETE FROM tp_picboard
		WHERE cont_id=#{cont_id}
	</delete>
	
	<update id="increaseViewCount" parameterType="int">
		UPDATE tp_picboard
		SET view_count=view_count+1
		WHERE cont_id=#{cont_id}
	</update>
	
	<select id="getCount" parameterType="int" resultType="int">
		SELECT NVL(MAX(ROWNUM), 0)
		FROM tp_picboard
		WHERE user_id=#{user_id}
	</select>
	
	<select id="showList" parameterType="int" resultType="picDto">
		SELECT cont_id,content_title,pic
		FROM tp_picboard
		WHERE user_id=#{user_id}
		ORDER BY content_date DESC
	</select>
	
</mapper>








